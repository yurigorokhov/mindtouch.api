(function(){var i=function(d,e){if(d>="a"&&d<="z"||d>="A"&&d<="Z"||d>="0"&&d<="9")return true;switch(d){case "'":case "(":case ")":case "*":case "-":case ".":case "_":case "!":return true}switch(e){case 3:switch(d){case "#":return true}case 2:switch(d){case "/":case ":":case "~":case "$":case ",":case ";":case "|":return true}case 1:switch(d){case "@":case "^":return true}break;case 0:switch(d){case "&":case "=":return true}}return false},g=function(d,e){e||(e="segment");for(var f=[],c=d.encodeUtf8().toBytes(),
b=0;b<c.length;++b){var a=c[b],h=String.fromCharCode(a);if(i(h,e))f.push(c[b]);else if(h==" ")f.push(43);else{f.push(37);f.push((a>>4&15)<=9?(a>>4&15)+48:(a>>4&15)-10+97);f.push((a&15)<=9?(a&15)+48:(a&15)-10+97)}}return String.fromCharCode.apply(null,f)};_.extend(String.prototype,{encodeUtf8:function(){for(var d="",e=0;e<this.length;e++){var f=this.charCodeAt(e);if(f<128)d+=String.fromCharCode(f);else{if(f>127&&f<2048)d+=String.fromCharCode(f>>6|192);else{d+=String.fromCharCode(f>>12|224);d+=String.fromCharCode(f>>
6&63|128)}d+=String.fromCharCode(f&63|128)}}return d},decodeUtf8:function(){for(var d="",e=0,f=c1=c2=0;e<this.length;){f=this.charCodeAt(e);if(f<128){d+=String.fromCharCode(f);e++}else if(f>191&&f<224){c2=this.charCodeAt(e+1);d+=String.fromCharCode((f&31)<<6|c2&63);e+=2}else{c2=this.charCodeAt(e+1);c3=this.charCodeAt(e+2);d+=String.fromCharCode((f&15)<<12|(c2&63)<<6|c3&63);e+=3}}return d},encodeBase64:function(){if(/([^\u0000-\u00ff])/.test(this))throw Error("Can't base64 encode non-ASCII characters.");
for(var d=0,e,f,c,b=[];d<this.length;){e=this.charCodeAt(d);c=d%3;switch(c){case 0:b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>2));break;case 1:b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f&3)<<4|e>>4));break;case 2:b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f&15)<<2|e>>6));b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e&63))}f=e;d++}if(c==0){b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f&
3)<<4));b.push("==")}else if(c==1){b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f&15)<<2));b.push("=")}return b.join("")},decodeBase64:function(){var d=this;d=d.replace(/\s/g,"");if(!/^[a-z0-9\+\/\s]+\={0,2}$/i.test(d)||d.length%4>0)throw Error("Not a base64-encoded string.");var e,f,c,b=0,a=[];for(d=d.replace(/=/g,"");b<d.length;){e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d.charAt(b));c=b%4;switch(c){case 1:a.push(String.fromCharCode(f<<
2|e>>4));break;case 2:a.push(String.fromCharCode((f&15)<<4|e>>2));break;case 3:a.push(String.fromCharCode((f&3)<<6|e))}f=e;b++}return a.join("")},toBytes:function(){for(var d,e,f=[],c=0;c<this.length;c++){d=this.charCodeAt(c);e=[];do{e.push(d&255);d>>=8}while(d);f=f.concat(e.reverse())}return f},encodeUrlFragment:function(){return g(this,3)},encodeUrlQuery:function(){return g(this,2)},encodeUrlSegment:function(){return g(this,1)},encodeUrlUserInfo:function(){return g(this,0)}})})();(function(){var i=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};_.mixin({guid:function(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()},callOrPublish:function(g,d){if(_.isFunction(g))g.apply(null,[d]);else if(_.isString(g))PageBus.publish(g,d);else throw Error("invalid plug callback");}})})();(function(){var i=this,g=i.PageBus={version:"3.0.0"};g.Subscription=function(b,a,h){this.id=_.uniqueId();this.callback=a;this.data=h;this.context=b;this.channel=null};_.extend(g.Subscription.prototype,{dispose:function(){if(this.channel)try{this.channel.unsubscribe(this)}finally{this.channel=null}}});g.Channel=function(){this.channels={};this.subscribers=[];this.lastMessage=null};_.extend(g.Channel.prototype,{subscribe:function(b,a,h){if(a===b.length){h.channel=this;this.subscribers.push(h);return h}var j=
this.channels[b[a]]||(this.channels[b[a]]=new g.Channel);try{return j.subscribe(b,a+1,h)}catch(k){j.isEmpty()&&delete this.channels[b[a]];throw k;}},publish:function(b,a,h,j,k){if(a===b.length){this.lastMessage=j;_.each(this.subscribers,function(l){k.push(_.bind(l.callback,l.context,h,j,l.data))})}else{var m=this.channels[b[a]]||(this.channels[b[a]]=new g.Channel);m.publish(b,a+1,h,j,k);m=this.channels["*"];_.isUndefined(m)||_.each(m.subscribers,function(l){k.push(_.bind(l.callback,l.context,h,j,
l.data))})}},query:function(b,a){if(a===b.length)return this.lastMessage;var h=this.channels[b[a]];return!_.isUndefined(h)?h.query(b,a+1):null},unsubscribe:function(b){for(var a=0;a<this.subscribers.length;++a)if(b.id===this.subscribers[a].id){this.subscribers.splice(a,1);break}},isEmpty:function(){return this.subscribers.length===0&&_.isEmpty(this.channels)&&this.lastMessage===null}});var d=new g.Channel,e=0,f=[],c=function(b,a){if(b===null||b==="")throw Error("PageBus.BadName");for(var h=b.split("."),
j=0;j<h.length;++j)if(h[j]===""||h[j].indexOf("*")!==-1&&(!a||h[j]!=="*"))throw Error("PageBus.BadName");return h};_.extend(g,{reset:function(){d=new g.Channel},subscribe:function(b,a,h,j){if(_.isFunction(a)){j=h;h=a;a=null}return d.subscribe(c(b,true),0,new g.Subscription(a||i,h,j))},publish:function(b,a){d.publish(c(b,false),0,b,a,f);if(e===0)try{for(++e;f.length;){var h=f;f=[];_.each(h,function(j){j()})}}finally{--e}},query:function(b){return d.query(c(b,false),0)},unsubscribe:function(b){b.dispose()}})})();(function(){var i=this.jQuery;this.Plug=function(c,b){if(!c)throw Error("missing url argument");if(!(this instanceof Plug))return new Plug(c,b);b||(b={});this.headers=b.headers||{};i.extend(this,typeof c==="string"?f(c):c,b)};var g=function(c){return i.extend(c,{getStatusText:function(){switch(this.status){case 100:return"Continue";case 101:return"Switching Protocols";case 200:return"Ok";case 201:return"Created";case 202:return"Accepted";case 203:return"Non-Authoritative Information";case 204:return"No Content";
case 205:return"Reset Content";case 206:return"Partial Content";case 207:return"Multi-Status";case 300:return"Multiple Choices";case 301:return"Moved Permanently";case 302:return"Found";case 303:return"See Other";case 304:return"Not Modified";case 305:return"Use Proxy";case 306:return"(Reserved)";case 307:return"Temporary Redirect";case 400:return"Bad Request";case 401:return"Unauthorized";case 402:return"Payment Required";case 403:return"Forbidden";case 404:return"Not Found";case 405:return"Method Not Allowed";
case 406:return"Not Acceptable";case 407:return"Proxy Authentication";case 408:return"Request Timeout";case 409:return"Conflict";case 410:return"Gone";case 411:return"Length Required";case 412:return"Precondition Failed";case 413:return"Request Entity Too Large";case 414:return"Request-URI Too Long";case 415:return"Unsupported Media Type";case 416:return"Requested Range Not Satisfiable";case 417:return"Expectation Failed";case 422:return"Unprocessable Entity";case 423:return"Locked";case 424:return"Failed Dependency";
case 500:return"Internal Server Error";case 501:return"Not Implemented";case 502:return"Bad Gateway";case 503:return"Service Unavailable";case 504:return"Gateway Timeout";case 505:return"HTTP Version Not Supported";case 507:return"Insufficient Storage"}return"(Unknown)"},isSuccess:function(){return this.status>=200&&this.status<300||this.status==304},getETag:function(){var b=this.getResponseHeader("ETag"),a=this.getResponseHeader("Content-Encoding");if(a&&a.length>0)b=b.replace("-"+a,"");return b},
errorMessage:function(){return(mesage||"Request failed")+" (status: "+this.status+" - "+this.getStatusText()+")"},isJson:function(){return(this.getResponseHeader("Content-Type")||"").substr(0,16)==="application/json"},getJson:function(){if(!this.isSuccess())throw Error("Response failed (status: "+this.status+" - "+this.getStatusText()+")");if(!this.isJson())throw Error("Response is not JSON (Content-Type: "+this.getResponseHeader("Content-Type")+")");return eval(this.responseText)}})},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(#.*)?)/,
e=["original","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","fragment"],f=function(c){if(!c)return{original:"",protocol:null,authority:null,userInfo:null,user:null,password:null,hostname:null,port:null,relative:null,path:null,directory:null,file:null,query:null,params:null,fragment:null,segments:[]};for(var b=d.exec(c),a={},h=0;h<e.length;++h)a[e[h]]=b[h]||null;a.fragment=a.fragment!==null?decodeURIComponent(a.fragment.substr(1)).decodeUtf8():
null;a.trailingSlash=a.path?a.path[a.path.length-1]==="/":false;a.params=c.indexOf("?")<0?null:function(){var j={};if(a.query!==null)for(var k=a.query.split("&"),m=0;m<k.length;++m)if(k[m]){var l=k[m].split("=");j[l[0]]=l.length>1?decodeURIComponent(l[1]).decodeUtf8():null}return j}();a.segments=function(){var j=a.path.replace(/^\//,"").replace(/\/$/,"").split("/");if(j.length===1&&j[0].length===0)j=[];else for(var k=0;k<j.length;++k)j[k]=decodeURIComponent(j[k]).decodeUtf8();return j}();a.protocol=
a.protocol?a.protocol:null;a.hostname=a.protocol?a.hostname||"":null;a.implicitPort=a.port===null;if(a.implicitPort&&a.protocol){switch(a.protocol){case "http":a.port="80";break;case "https":a.port="443";break;case "ftp":a.port="21";break;case "file":a.port=null;break;default:a.port=0}b=a.protocol+"://"+a.hostname+":";a.implicitPort=c.substr(0,b.length)!==b}return a};i.extend(this.Plug.prototype,{getUrl:function(){var c="";if(this.protocol)c+=this.protocol+"://"+this.hostname;if(!this.implicitPort&&
this.port)c+=":"+this.port;for(var b=0;b<this.segments.length;++b)c+="/"+this.segments[b].encodeUrlSegment();if(this.trailingSlash)c+="/";if(this.params){c+="?";var a=true;i.each(this.params,function(h,j){a||(c+="&");a=false;c+=h.encodeUrlQuery();if(j!==null)c+="="+j.encodeUrlQuery()})}if(this.fragment!==null)c+="#"+this.fragment.encodeUrlFragment();return c},get:function(c,b){var a=c!=null,h=i.ajax({context:this,async:a,url:this.getUrl(),type:b||"GET",cache:false,beforeSend:this._beforeSend,complete:a&&
function(j){_.callOrPublish(c,g(j))}});if(!a)return g(h)},post:function(c,b,a){var h=a!=null;c=i.ajax({context:this,async:h,url:this.getUrl(),type:"POST",data:c,contentType:b,processData:false,beforeSend:this._beforeSend,complete:h&&function(j){_.callOrPublish(a,g(j))}});if(!h)return g(c)},put:function(c,b,a){return this.withHeader("X-HTTP-Method-Override","PUT").post(c,b,a)},head:function(c){return this.get(c,"HEAD")},options:function(c){return this.get(c,"OPTIONS")},del:function(c){return this.withHeader("X-HTTP-Method-Override",
"DELETE").post(null,null,c)},at:function(){for(var c=0;c<arguments.length;++c)if(arguments[c]===null)throw Error("argument "+(c+1)+" is null");var b=[];i.each(this.segments,function(a,h){b.push(h.toString())});i.each(arguments,function(a,h){b.push(h.toString())});return new Plug(this,i.extend({},this.options,{segments:b,trailingSlash:false}))},withParam:function(c,b){var a=i.extend({},this.params);a[c]=b;return new Plug(this,i.extend({},this.options,{params:a}))},withParams:function(c){c=i.extend({},
this.params,c);return new Plug(this,i.extend({},this.options,{params:c}))},withoutParam:function(c){var b=i.extend({},this.params);delete b[c];return new Plug(this,i.extend({},this.options,{params:b}))},withTrailingSlash:function(){return new Plug(this,i.extend({},this.options,{trailingSlash:true}))},withoutTrailingSlash:function(){return new Plug(this,i.extend({},this.options,{trailingSlash:true}))},withHeader:function(c,b){var a=i.extend({},this.headers);a[c]=b;return new Plug(this,i.extend({},
this.options,{headers:a}))},withHeaders:function(c){c=i.extend({},this.headers,c);return new Plug(this,i.extend({},this.options,{headers:c}))},withoutHeader:function(c){var b=i.extend({},this.headers);delete b[c];return new Plug(this,i.extend({},this.options,{headers:b}))},_beforeSend:function(c){this.headers&&i.each(this.headers,function(b,a){typeof a!="object"&&typeof a!="function"&&c.setRequestHeader(b,a)});this.protocol==="https"&&c.setRequestHeader("Front-End-Https","On");return true}})})();(function(){this.Property=function(g){if(_.isString(g)){var d=g.indexOf("#");g=d>=0?{name:g.substr(0,d),namespace:g.substr(d+1)}:{name:g}}g||(g={});this.name=g.name||"default";this.namespace=g.namespace||"urn:custom.mindtouch.com";this.property=this.namespace+"#"+this.name;this.mime=g.mime||"application/json; charset=utf-8";this.serialize=g.serialize||JSON.stringify;this.deserialize=g.deserialize||JSON.parse;this.etag=this.value=null;g=(new Plug(Deki.BaseHref)).at("@api","deki","pages",Deki.PageId,
"properties");this.plug=(new Plug(g)).at(this.property.encodeUrlSegment())};var i=function(g,d,e,f){if(f)_.callOrPublish(f,{status:e.status,text:e.getStatusText(),xhr:e});else throw Error(e.errorMessage("An error occurred trying to "+d+" property '"+g+"'"));};_.extend(this.Property.prototype,{get:function(g,d){var e=this,f=function(b){if(b.isSuccess()){if(b.status!=304){e.value=e.deserialize(b.responseText);e.etag=b.getETag()}if(g)_.callOrPublish(g,e);else return e.value}return i(e.property,"get",
b,d)},c=this.plug;if(g)c.get(f);else{c=c.get();return f(c)}},set:function(g,d,e){var f=this,c=function(a){if(a.isSuccess()){f.value=g;f.etag=a.getETag();if(d)_.callOrPublish(d,f);else return f.value}return i(f.property,"set",a,e)},b=this.plug.withParam("abort","never");if(this.etag)b=b.withHeader("ETag",this.etag);if(d)b.put(this.serialize(g),this.mime,c);else{b=b.put(this.serialize(g),this.mime);return c(b)}},destroy:function(g,d){var e=this,f=function(b){if(b.isSuccess()){e.value=null;e.etag=null;
if(g)_.callOrPublish(g,e);else return e.value}return i(e.property,"delete",b,d)};if(g)plug.del(f);else{var c=plug.del();return f(c)}}})})();
