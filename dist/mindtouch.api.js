(function(){var j=function(f,a){if(f>="a"&&f<="z"||f>="A"&&f<="Z"||f>="0"&&f<="9")return true;switch(f){case "'":case "(":case ")":case "*":case "-":case ".":case "_":case "!":return true}switch(a){case 3:switch(f){case "#":return true}case 2:switch(f){case "/":case ":":case "~":case "$":case ",":case ";":case "|":return true}case 1:switch(f){case "@":case "^":return true}break;case 0:switch(f){case "&":case "=":return true}}return false},g=function(f,a){a||(a="segment");for(var b=[],d=f.encodeUtf8().toBytes(),
c=0;c<d.length;++c){var e=d[c],h=String.fromCharCode(e);if(j(h,a))b.push(d[c]);else if(h==" ")b.push(43);else{b.push(37);b.push((e>>4&15)<=9?(e>>4&15)+48:(e>>4&15)-10+97);b.push((e&15)<=9?(e&15)+48:(e&15)-10+97)}}return String.fromCharCode.apply(null,b)};_.extend(String.prototype,{encodeUtf8:function(){for(var f="",a=0;a<this.length;a++){var b=this.charCodeAt(a);if(b<128)f+=String.fromCharCode(b);else{if(b>127&&b<2048)f+=String.fromCharCode(b>>6|192);else{f+=String.fromCharCode(b>>12|224);f+=String.fromCharCode(b>>
6&63|128)}f+=String.fromCharCode(b&63|128)}}return f},decodeUtf8:function(){for(var f="",a=0,b=c1=c2=0;a<this.length;){b=this.charCodeAt(a);if(b<128){f+=String.fromCharCode(b);a++}else if(b>191&&b<224){c2=this.charCodeAt(a+1);f+=String.fromCharCode((b&31)<<6|c2&63);a+=2}else{c2=this.charCodeAt(a+1);c3=this.charCodeAt(a+2);f+=String.fromCharCode((b&15)<<12|(c2&63)<<6|c3&63);a+=3}}return f},encodeBase64:function(){if(/([^\u0000-\u00ff])/.test(this))throw Error("Can't base64 encode non-ASCII characters.");
for(var f=0,a,b,d,c=[];f<this.length;){a=this.charCodeAt(f);d=f%3;switch(d){case 0:c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>2));break;case 1:c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((b&3)<<4|a>>4));break;case 2:c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((b&15)<<2|a>>6));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63))}b=a;f++}if(d==0){c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((b&
3)<<4));c.push("==")}else if(d==1){c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((b&15)<<2));c.push("=")}return c.join("")},decodeBase64:function(){var f=this;f=f.replace(/\s/g,"");if(!/^[a-z0-9\+\/\s]+\={0,2}$/i.test(f)||f.length%4>0)throw Error("Not a base64-encoded string.");var a,b,d,c=0,e=[];for(f=f.replace(/=/g,"");c<f.length;){a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f.charAt(c));d=c%4;switch(d){case 1:e.push(String.fromCharCode(b<<
2|a>>4));break;case 2:e.push(String.fromCharCode((b&15)<<4|a>>2));break;case 3:e.push(String.fromCharCode((b&3)<<6|a))}b=a;c++}return e.join("")},toBytes:function(){for(var f,a,b=[],d=0;d<this.length;d++){f=this.charCodeAt(d);a=[];do{a.push(f&255);f>>=8}while(f);b=b.concat(a.reverse())}return b},encodeUrlFragment:function(){return g(this,3)},encodeUrlQuery:function(){return g(this,2)},encodeUrlSegment:function(){return g(this,1)},encodeUrlUserInfo:function(){return g(this,0)}})})();(function(){var j=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};_.mixin({guid:function(){return j()+j()+"-"+j()+"-"+j()+"-"+j()+"-"+j()+j()+j()}})})();(function(){var j=this,g=j.PageBus={version:"3.0.0"};g.Subscription=function(c,e,h){this.id=_.uniqueId();this.callback=e;this.data=h;this.context=c;this.channel=null};_.extend(g.Subscription.prototype,{dispose:function(){if(this.channel)try{this.channel.unsubscribe(this)}finally{this.channel=null}}});g.Channel=function(){this.channels={};this.subscribers=[];this.lastMessage=null};_.extend(g.Channel.prototype,{subscribe:function(c,e,h){if(e===c.length){h.channel=this;this.subscribers.push(h);return h}var i=
this.channels[c[e]]||(this.channels[c[e]]=new g.Channel);try{return i.subscribe(c,e+1,h)}catch(k){i.isEmpty()&&delete this.channels[c[e]];throw k;}},publish:function(c,e,h,i,k){if(e===c.length){this.lastMessage=i;_.each(this.subscribers,function(l){k.push(_.bind(l.callback,l.context,h,i,l.data))})}else{var m=this.channels[c[e]]||(this.channels[c[e]]=new g.Channel);m.publish(c,e+1,h,i,k);m=this.channels["*"];_.isUndefined(m)||_.each(m.subscribers,function(l){k.push(_.bind(l.callback,l.context,h,i,
l.data))})}},query:function(c,e){if(e===c.length)return this.lastMessage;var h=this.channels[c[e]];return!_.isUndefined(h)?h.query(c,e+1):null},unsubscribe:function(c){for(var e=0;e<this.subscribers.length;++e)if(c.id===this.subscribers[e].id){this.subscribers.splice(e,1);break}},isEmpty:function(){return this.subscribers.length===0&&_.isEmpty(this.channels)&&this.lastMessage===null}});var f=new g.Channel,a=0,b=[],d=function(c,e){if(c===null||c==="")throw Error("PageBus.BadName");for(var h=c.split("."),
i=0;i<h.length;++i)if(h[i]===""||h[i].indexOf("*")!==-1&&(!e||h[i]!=="*"))throw Error("PageBus.BadName");return h};_.extend(g,{reset:function(){f=new g.Channel},subscribe:function(c,e,h,i){if(_.isFunction(e)){i=h;h=e;e=null}return f.subscribe(d(c,true),0,new g.Subscription(e||j,h,i))},publish:function(c,e){f.publish(d(c,false),0,c,e,b);if(a===0)try{for(++a;b.length;){var h=b;b=[];_.each(h,function(i){i()})}}finally{--a}},query:function(c){return f.query(d(c,false),0)},unsubscribe:function(c){c.dispose()}})})();(function(){var j=function(a){return _.extend(a,{getStatusText:function(){switch(this.status){case 100:return"Continue";case 101:return"Switching Protocols";case 200:return"Ok";case 201:return"Created";case 202:return"Accepted";case 203:return"Non-Authoritative Information";case 204:return"No Content";case 205:return"Reset Content";case 206:return"Partial Content";case 207:return"Multi-Status";case 300:return"Multiple Choices";case 301:return"Moved Permanently";case 302:return"Found";case 303:return"See Other";
case 304:return"Not Modified";case 305:return"Use Proxy";case 306:return"(Reserved)";case 307:return"Temporary Redirect";case 400:return"Bad Request";case 401:return"Unauthorized";case 402:return"Payment Required";case 403:return"Forbidden";case 404:return"Not Found";case 405:return"Method Not Allowed";case 406:return"Not Acceptable";case 407:return"Proxy Authentication";case 408:return"Request Timeout";case 409:return"Conflict";case 410:return"Gone";case 411:return"Length Required";case 412:return"Precondition Failed";
case 413:return"Request Entity Too Large";case 414:return"Request-URI Too Long";case 415:return"Unsupported Media Type";case 416:return"Requested Range Not Satisfiable";case 417:return"Expectation Failed";case 422:return"Unprocessable Entity";case 423:return"Locked";case 424:return"Failed Dependency";case 500:return"Internal Server Error";case 501:return"Not Implemented";case 502:return"Bad Gateway";case 503:return"Service Unavailable";case 504:return"Gateway Timeout";case 505:return"HTTP Version Not Supported";
case 507:return"Insufficient Storage"}return"(Unknown)"},isSuccess:function(){return this.status>=200&&this.status<300||this.status==304},getETag:function(){var b=this.getResponseHeader("ETag"),d=this.getResponseHeader("Content-Encoding");if(d&&d.length>0)b=b.replace("-"+d,"");return b},errorMessage:function(){return(mesage||"Request failed")+" (status: "+this.status+" - "+this.getStatusText()+")"}})},g=function(a){if(!a)return{original:"",protocol:"",host:"",port:"0",params:null,fragment:null,segments:[]};
var b=document.createElement("a");b.href=a;var d={original:a,port:b.port&&b.port!=="0"?b.port:null,params:function(){for(var e=a.indexOf("?")>=0?{}:null,h=b.search.replace(/^\?/,"").split("&"),i=0;i<h.length;i++)if(h[i]){var k=h[i].split("=");e[k[0]]=k.length>1?decodeURIComponent(k[1]).decodeUtf8():null}return e}(),fragment:a.indexOf("#")!=-1?decodeURIComponent(b.hash.substr(1)).decodeUtf8():null,segments:function(){var e=b.pathname.replace(/^\//,"").replace(/\/$/,"").split("/");if(e.length===1&&
e[0].length===0)e=[];else for(var h=0;h<e.length;++h)e[h]=decodeURIComponent(e[h]).decodeUtf8();return e}(),trailingSlash:b.pathname?b.pathname[b.pathname.length-1]=="/":false};d.protocol=b.protocol!=="file:"||a.substr(0,7)==="file://"?b.protocol.replace(":",""):null;d.hostname=d.protocol?b.hostname:null;d.implicitPort=d.port===null;if(d.implicitPort&&d.protocol){switch(d.protocol){case "http":d.port="80";break;case "https":d.port="443";break;case "ftp":d.port="21";break;case "file":d.port=null;break;
default:d.port=0}var c=d.protocol+"://"+d.hostname+":";d.implicitPort=a.substr(0,c.length)!==c}return d},f=function(a,b){if(_.isString(a))PageBus.publish(a,b);else if(_.isFunction(a))a.apply(null,[b]);else throw Error("invalid plug callback");};this.Plug=function(a,b){if(!a)throw Error("missing url argument");b||(b={});this.headers=b.headers||{};_.extend(this,_.isString(a)?g(a):a,b)};_.extend(this.Plug.prototype,{getUrl:function(){var a="";if(this.protocol)a+=this.protocol+"://"+this.hostname;if(!this.implicitPort&&
this.port)a+=":"+this.port;for(var b=0;b<this.segments.length;++b)a+="/"+this.segments[b].encodeUrlSegment();if(this.trailingSlash)a+="/";if(this.params){a+="?";var d=true;_.each(this.params,function(c,e){d||(a+="&");d=false;a+=e.encodeUrlQuery();if(c!==null)a+="="+c.encodeUrlQuery()})}if(this.fragment!==null)a+="#"+this.fragment.encodeUrlFragment();return a},get:function(a,b){var d=a!=null,c=$.ajax({context:this,async:d,url:this.getUrl(),type:b||"GET",cache:false,beforeSend:this._beforeSend,complete:function(e){j(e);
if(a)f(a,e);else if(!e.isSuccess())throw Error("Plug "+(this.headers["X-HTTP-Method-Override"]||"GET")+" request failed for "+this.getUrl()+" (status: "+e.status+" - "+e.getStatusText()+")");}});if(!d){j(c);return c}},post:function(a,b,d){var c=d!=null;a=$.ajax({context:this,async:c,url:this.getUrl(),type:"POST",data:a,contentType:b,processData:false,beforeSend:this._beforeSend,complete:function(e){j(e);if(d)f(d,e);else if(!e.isSuccess())throw Error("Plug "+(this.headers["X-HTTP-Method-Override"]||
"POST")+" request failed for "+this.getUrl()+" (status: "+e.status+" - "+e.getStatusText()+")");}});if(!c){j(a);return a}},put:function(a,b,d){return this.withHeader("X-HTTP-Method-Override","PUT").post(a,b,d)},head:function(a){return this.get(a,"HEAD")},options:function(a){return this.get(a,"OPTIONS")},del:function(a){return this.withHeader("X-HTTP-Method-Override","DELETE").post(null,null,a)},at:function(){for(var a=0;a<arguments.length;++a)if(_.isNull(arguments[a]))throw Error("argument "+(a+1)+
" is null");a=this.segments.concat.apply(this.segments,_.map(arguments,function(b){return _.isString(b)?b:new String(b)}));return new Plug(this,_.extend({},this.options,{segments:a,trailingSlash:false}))},withParam:function(a,b){var d=_.extend({},this.params);d[a]=b;return new Plug(this,_.extend({},this.options,{params:d}))},withParams:function(a){a=_.extend({},this.params,a);return new Plug(this,_.extend({},this.options,{params:a}))},withoutParam:function(a){var b=_.extend({},this.params);delete b[a];
return new Plug(this,_.extend({},this.options,{params:b}))},withTrailingSlash:function(){return new Plug(this,_.extend({},this.options,{trailingSlash:true}))},withoutTrailingSlash:function(){return new Plug(this,_.extend({},this.options,{trailingSlash:true}))},withHeader:function(a,b){var d=_.extend({},this.headers);d[a]=b;return new Plug(this,_.extend({},this.options,{headers:d}))},withHeaders:function(a){a=_.extend({},this.headers,a);return new Plug(this,_.extend({},this.options,{headers:a}))},
withoutHeader:function(a){var b=_.extend({},this.headers);delete b[a];return new Plug(this,_.extend({},this.options,{headers:b}))},_beforeSend:function(a){this.headers&&$.each(this.headers,function(b,d){typeof d!="object"&&typeof d!="function"&&a.setRequestHeader(b,d)});this.protocol==="https"&&a.setRequestHeader("Front-End-Https","On");return true}})})();(function(){this.Property=function(g){if(_.isString(g))g={name:g};g||(g={});this.name=g.name||"default";this.namespace=g.namespace||"urn:custom.mindtouch.com";this.property=this.namespace+"#"+this.name;this.mime=g.mime||"application/json; charset=utf-8";this.serialize=g.serialize||JSON.stringify;this.deserialize=g.deserialize||JSON.parse;this.etag=this.value=null;g=(new Plug(Deki.BaseHref)).at("@api","deki","pages",Deki.PageId,"properties");this.plug=(new Plug(g)).at(this.property.encodeUrlSegment())};
var j=function(g,f,a,b){if(b)_.publish(b,{status:a.status,text:a.getStatusText(),xhr:a});else throw Error(a.errorMessage("An error occurred trying to "+f+" property '"+g+"'"));};_.extend(this.Property.prototype,{get:function(g,f){var a=this,b=function(c){if(c.isSuccess()){if(c.status!=304){a.value=a.deserialize(c.responseText);a.etag=c.getETag()}if(g)_.publish(g,a);else return a.value}return j(a.property,"get",c,f)},d=this.plug;if(g)d.get(b);else{d=d.get();return b(d)}},set:function(g,f,a){var b=
this,d=function(e){if(e.isSuccess()){b.value=g;b.etag=e.getETag();if(f)_.publish(f,b);else return b.value}return j(b.property,"set",e,a)},c=this.plug.withParam("abort","never");if(this.etag)c=c.withHeader("ETag",this.etag);if(f)c.put(this.serialize(g),this.mime,d);else{c=c.put(this.serialize(g),this.mime);return d(c)}},destroy:function(g,f){var a=this,b=function(c){if(c.isSuccess()){a.value=null;a.etag=null;if(g)_.publish(g,a);else return a.value}return j(a.property,"delete",c,f)};if(g)plug.del(b);
else{var d=plug.del();return b(d)}}})})();
